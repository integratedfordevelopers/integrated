{% extends 'IntegratedContentBundle::base.html.twig' %}
{% block crumbs %}
    <div class="breadcrumb-holder">
        <div class="container">
            <ol class="breadcrumb">
                <li>
                    <a href="{{ path('integrated_import_index') }}">{% trans %}Import{% endtrans %}</a>
                </li>
                <li class="active">{% trans %}Choose import file{% endtrans %}</li>
            </ol>
        </div>
    </div>
{% endblock %}
{% block content %}
    <form method="post" id="composeForm">
        <input type="hidden" name="action" value="go" />
        <input type="hidden" name="startRow" value="{{ startRow }}" />

    <div class="pull-right">
        <a class="btn btn-gray-thin" href="{# { path("integrated_import_edit", {'id': id }) }} #}">{% trans %}Back{% endtrans %}</a>&nbsp;
        <button class="btn btn-orange" type="submit">{% trans %}Next{% endtrans %}</button>
    </div>

    <h1>{% trans %}Step 3 of 3: Compose definition{% endtrans %}</h1>

    <section class="section-white section-padding section-shadow section-radius section-margin" style="width: fit-content">

        <div class="container">
            {% trans %}{1}Choose the operations you wish to perform on the selected content item|]1,Inf[Choose the operation you wish to perform on the selected content items{% endtrans  %}
        </div>

        <hr/>

        <style>
            .importdata th, .importdata td {
                vertical-align: top;
                padding-bottom: 5px;
            }
        </style>
    <table class="importdata">
        {% for row in data %}
            <tr>
                {% if loop.first %}
                    {% for col in row %}
                        <th>{{ col }}</th>
                    {% endfor %}
                {% else %}
                    {% for col in row %}
                        <td>{{ col|truncate(30) }}</td>
                    {% endfor %}
                {% endif %}
            </tr>
            {% if loop.first %}
                <tr>
                    {% for col in row %}
                        {%  set colIndex = loop.index0 %}
                        <th>
                            <select name="col{{ colIndex }}" id="col{{ colIndex }}" class="import-fieldchoice">
                                {% for fieldKey, field in fields %}
                                    <option value="{{ fieldKey }}" {% if field.matchCol is same as(colIndex) %} selected="selected"{% endif %}>{{ field.label }}</option>
                                {% endfor %}
                            </select>
                        </th>
                    {% endfor %}
                </tr>
            {% endif %}
        {% endfor %}
    </table>
    </section>

    <div class="pull-right">
        <a class="btn btn-gray-thin" href="{# { path("integrated_import_edit", {'id': id }) }} #}">{% trans %}Back{% endtrans %}</a>&nbsp;
        <button class="btn btn-orange" type="submit">{% trans %}Next{% endtrans %}</button>
    </div>

    </form>
{% endblock %}

{% block javascript %}
{{ parent() }}

<script>
    $(document).ready(function() {
        $('.import-fieldchoice').select2();
    });
</script>
    {% if (startRow > 0) %}
        <script>
            $('#composeForm').submit();
        </script>
    {% endif %}
{% endblock %}